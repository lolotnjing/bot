<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Multi Ai By Rafz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ===== BOT INFO MODAL ===== -->
<div class="bot-info" id="botInfo" onclick="closeBotInfo(event)">
  <div class="bot-info-box">
    <img id="botInfoAvatar">
    <h3 id="botInfoName"></h3>
    <p id="botInfoDesc"></p>
    <button onclick="closeBotInfo()">Tutup</button>
  </div>
</div>


<div class="bg-glow"></div>

<div class="chat-app">

<div class="chat-header">
 <div class="header-left">
  <img id="botAvatar" src="kiss.jpg">
  <div>
    
    <div class="bot-area"></div>
   <b id="botName">Kashiwada-san</b>
   <div class="status">online</div>
  </div>
 </div>
 <div class="header-right" onclick="openDrawer()">☰</div>
</div>

<div class="chat-body" id="chat"></div>

<div class="chat-input">
 <div class="input-box">
  <textarea id="msg" rows="1" placeholder="Ketik pesan..."></textarea>
  <button onclick="send()"><i class="fa-solid fa-paper-plane"></i></button>
 </div>
</div>
</div>

<div class="drawer-overlay" id="overlay" onclick="closeDrawer()"></div>
<div class="drawer" id="drawer">
 <h3>Pilih Model</h3>

 <div class="model-card active" onclick="setAI('kashiwada',this)">
  <img src="kiss.jpg"> Kashiwada
 </div>
 <div class="model-card" onclick="setAI('mahiru',this)">
  <img src="mahiru.jpg"> Mahiru
 </div>
 <div class="model-card" onclick="setAI('felo',this)">
  <img src="felo.jpg"> Felo
 </div>
 <div class="model-card" onclick="setAI('kauruko',this)">
 <img src="kauruko.jpg"> Kauruko <span class="badge-new">NEW</span>
</div>
 <div class="model-card" onclick="setAI('ryo',this)">
 <img src="ryo.jpg"> Ryoo <span class="badge-new">NEW</span>
</div>
<div class="model-card" onclick="setAI('chatgpt',this)">
 <img src="chatgpt.jpg"> ChatGPT  <span class="badge-new">NEW</span>
</div>

 <div class="model-info" id="modelInfo"></div>
 <div class="user-memory" id="userMemory"></div>

 <h3>Profil Kamu</h3>
 <div class="user-profile">
  <div class="avatar-picker" onclick="pickAvatar()">
   <img id="userAvatarPreview" src="user.jpg">
  </div>
  <input type="file" id="userAvatarInput" accept="image/*">
  <input type="text" id="userNameInput" placeholder="Nama kamu">
  <button class="save-profile" onclick="saveProfile()">Simpan Profil</button>
 </div>

<h4>Galeri</h4>
 <div class="char-swipe">
  <div class="swipe-track">
    <img src="rimuru.jpg">
    <img src="rimuru2.jpg">
    <img src="rimuru3.jpg">

    <img src="mahiru.jpg">
    <img src="mahiru1.jpg">
    <img src="mahiru2.jpg">
    <img src="mahiru3.jpg">

    <img src="kashiwada.jpg">
    <img src="kashiwada2.jpg">
    <img src="kashiwada3.jpg">
  </div>

  <!-- DOT KOSONG, DIISI JS -->
  <div class="swipe-dots"></div>
</div>



 <button class="close-btn" onclick="closeDrawer()">Tutup</button>
</div>

<div class="toast" id="toast"></div>

<!-- ===== NOTICE INFO PAS MASUK ===== -->
<div class="login-notice" id="loginNotice">
 <div class="notice-box">
  <i class="fa-solid fa-circle-info notice-icon"></i>
  <h3>Informasi</h3>
  <p>
   Chat ini <b>bersifat sementara</b>.<br>
   Riwayat pesan akan hilang jika halaman ditutup atau direfresh.
  </p>
  <b>Rafz <span class="badge verified">
    <i class="fa-solid fa-circle-check"></i> </b>
    <div class="owner-social">
  <a href="https://wa.me/6281549426361" target="_blank" rel="noopener">
    <i class="fa-brands fa-whatsapp"></i>
  </a>

  <a href="https://www.youtube.com/@xyraa34k" target="_blank" rel="noopener">
    <i class="fa-brands fa-youtube"></i>
  </a>

  <a href="https://nekopoi-care-rho.vercel.app/" target="_blank" rel="noopener">
    <i class="fa-solid fa-globe"></i>
  </a>
</div>
  <button onclick="closeNotice()">Mengerti</button>
 </div>
</div>
<div class="gallery-preview" id="galleryPreview" onclick="closePreview()">
 <img id="previewImg">
</div>
<script>
const chat=document.getElementById("chat")
const msg=document.getElementById("msg")

/* ===== NOTICE LOGIC (AUTO CLOSE 5 DETIK) ===== */
const track = document.querySelector(".swipe-track");
const dotsWrap = document.querySelector(".swipe-dots");
const slides = track.querySelectorAll("img");
const total = slides.length;

let index = 0;
let startX = 0;
let autoSlide;

/* ===== BUAT DOT OTOMATIS ===== */
slides.forEach((_,i)=>{
 const dot = document.createElement("span");
 if(i===0) dot.classList.add("active");
 dotsWrap.appendChild(dot);
});

const dots = dotsWrap.querySelectorAll("span");

/* ===== UPDATE ===== */
function update(){
 track.style.transform = `translateX(-${index * 100}%)`;
 dots.forEach((d,i)=>d.classList.toggle("active",i===index));
}

/* ===== AUTO SLIDE ===== */
function startAuto(){
 autoSlide = setInterval(()=>{
  index = (index + 1) % total;
  update();
 },3000);
}
function stopAuto(){
 clearInterval(autoSlide);
}
startAuto();

/* ===== SWIPE ===== */
track.addEventListener("touchstart", e=>{
 stopAuto();
 startX = e.touches[0].clientX;
});

track.addEventListener("touchend", e=>{
 let diff = startX - e.changedTouches[0].clientX;

 if(diff > 50) index = (index + 1) % total;
 if(diff < -50) index = (index - 1 + total) % total;

 update();
 startAuto();
});
const botArea=document.querySelector(".bot-area")

botArea.onclick=()=>{
 const ai=AIs[current]
 botInfoAvatar.src=ai.avatar
 botInfoName.innerText=ai.name
 botInfoDesc.innerText=ai.desc||ai.info
 botInfo.classList.add("show")
}
const botInfo=document.getElementById("botInfo")
const botInfoAvatar=document.getElementById("botInfoAvatar")
const botInfoName=document.getElementById("botInfoName")
const botInfoDesc=document.getElementById("botInfoDesc")

botAvatar.onclick=()=>{
 const ai=AIs[current]
 botInfoAvatar.src=ai.avatar
 botInfoName.innerText=ai.name
 botInfoDesc.innerText=ai.desc||ai.info
 botInfo.classList.add("show")
}

function closeBotInfo(e){
 if(e && e.target!==botInfo) return
 botInfo.classList.remove("show")
}

const galleryPreview=document.getElementById("galleryPreview")
const previewImg=document.getElementById("previewImg")
function openPreview(src){
 previewImg.src=src
 galleryPreview.classList.add("active")
}
function closePreview(){
 galleryPreview.classList.remove("active")
}
const loginNotice=document.getElementById("loginNotice")
if(!sessionStorage.getItem("noticeShown")){
 loginNotice.classList.add("show")
 sessionStorage.setItem("noticeShown","yes")
 setTimeout(()=>closeNotice(),5000)
}
function closeNotice(){
 loginNotice.classList.remove("show")
}

/* ===== FORMAT TEXT ===== */
function formatText(t){
 return t
  .replace(/#{1,6}\s?/g,"") 
  .replace(/\*\*(.*?)\*\*/g,"$1")
  .replace(/\n{3,}/g,"\n\n")
  .replace(/:\n-/g,":\n•")
  .replace(/\n-/g,"\n•")
  .replace(/\n\n/g,"<br><br>")
}
/* ===== USER ===== */
let userName=localStorage.getItem("userName")|| "kamu :"
let userAvatar=localStorage.getItem("userAvatar")||"user.jpg"
const userNameInput=document.getElementById("userNameInput")
const userAvatarInput=document.getElementById("userAvatarInput")
const userAvatarPreview=document.getElementById("userAvatarPreview")
userNameInput.value=userName
userAvatarPreview.src=userAvatar

function pickAvatar(){userAvatarInput.click()}
userAvatarInput.onchange=()=>{
 const f=userAvatarInput.files[0]
 if(!f) return
 const r=new FileReader()
 r.onload=e=>userAvatarPreview.src=e.target.result
 r.readAsDataURL(f)
}

/* ===== TOAST ===== */
function showToast(t){
 const toast=document.getElementById("toast")
 toast.textContent=t
 toast.classList.add("show")
 setTimeout(()=>toast.classList.remove("show"),2500)
}

function saveProfile(){
 userName=userNameInput.value||"Kamu"
 userAvatar=userAvatarPreview.src
 localStorage.setItem("userName",userName)
 localStorage.setItem("userAvatar",userAvatar)
 showToast("Profil disimpan")
 closeDrawer()
}

/* ===== DRAWER ===== */
const drawer=document.getElementById("drawer")
const overlay=document.getElementById("overlay")
function openDrawer(){drawer.classList.add("active");overlay.classList.add("active")}
function closeDrawer(){drawer.classList.remove("active");overlay.classList.remove("active")}

/* ===== AI (UTUH, TIDAK DISENTUH) ===== */
const AIs={
 kashiwada:{name:"Kashiwada-san",avatar:"kiss.jpg",info:"Tenang & sopan",
 api:t=>`https://api.ootaizumi.web.id/character/kashiwada-san?message=${encodeURIComponent(t)}`,
 parse:d=>d.message},
 mahiru:{name:"Shiina Mahiru",avatar:"mahiru.jpg",info:"Manis & perhatian",
 api:t=>`https://api.ryuu-dev.offc.my.id/ai/mahiru-ai?text=${encodeURIComponent(t)}`,
 parse:d=>d.output},
 felo:{name:"Felo",avatar:"felo.jpg",info:"Santai & bebas",
 api:t=>`https://api.ryuu-dev.offc.my.id/ai/felo?text=${encodeURIComponent(t)}`,
 parse:d=>d.result||d.output||d.message},
 kauruko:{
 name:"Kauruko Wuguri",
 avatar:"kauruko.jpg",
 info:"Tenang, anggun, lembut",
 api:t=>{
  const prompt = "Kamu adalah Kauruko Wuguri dari anime Kaoru Hana wa Rin to Saku. Kamu dikenal sebagai gadis yang tenang, kalem, dan lembut. Jawabanmu harus anggun, menenangkan, dan tidak pernah kasar."
  return `https://api.siputzx.my.id/api/ai/gpt3?prompt=${encodeURIComponent(prompt)}&content=${encodeURIComponent(t)}`
 },
parse:d=>{
 if(!d) return "…"
 return d.data || d.result || d
}
},
ryo:{
 name:"Ryoo Yamada",
 avatar:"ryo.jpg",
 info:"Cuek",
 api:t=>{
  const prompt = "Kamu adalah Ryo Yamada dari anime Bocchi the Rock!. Kamu cewek cuek, misterius, dan kadang jawab seenaknya. Jawabanmu singkat dan kadang absurd."
  return `https://api.siputzx.my.id/api/ai/gpt3?prompt=${encodeURIComponent(prompt)}&content=${encodeURIComponent(t)}`
 },
parse:d=>{
 if(!d) return "…"
 return d.data || d.result || d
}
},
 chatgpt:{
  name:"ChatGPT",
  avatar:"chatgpt.jpg",
  info:"AI serba bisa (Varhad API)",
  api:t=>`https://api-varhad.my.id/ai/chatgpt?q=${encodeURIComponent(t)}`,
  parse:d=>{
   if(!d.status || !d.result) return "API ChatGPT error"

   const msg=d.result.output?.find(o=>o.type==="message")
   const text=msg?.content?.find(c=>c.type==="output_text")?.text

   return text || "ChatGPT tidak merespon teks."
  }
 }
 /*Model Di sini*/
}
let current="kashiwada"
modelInfo.innerText=AIs[current].info

function add(role,text){
 chat.innerHTML+=`
 <div class="row ${role}">
  <img src="${role==='bot'?AIs[current].avatar:userAvatar}">
  <div class="msg-box">
   <div class="msg-name">${role==='bot'?AIs[current].name:userName}</div>
   <div class="bubble ${role}">${text}</div>
  </div>
 </div>`
 chat.scrollTop=chat.scrollHeight
}

async function send(){
 const t=msg.value.trim()
 if(!t) return

 add("user",t)
 msg.value=""

 chat.innerHTML+=`
 <div class="row bot" id="typing">
  <img src="${AIs[current].avatar}">
  <div class="typing"><span></span><span></span><span></span></div>
 </div>`
 chat.scrollTop=chat.scrollHeight

 try{
  const r = await fetch(AIs[current].api(t))
  const d = await r.json()

  document.getElementById("typing")?.remove()

  let text
  try{
    text = AIs[current].parse(d)
  }catch(e){
    console.error("PARSE ERROR:", e, d)
    text = "AI tidak bisa membaca respon."
  }

  if(!text || typeof text !== "string"){
    text = "AI tidak memberi teks balasan."
  }

  add("bot", formatText(text))

 }catch(err){
  document.getElementById("typing")?.remove()
  console.error("FETCH ERROR:", err)
  add("bot","Terjadi kesalahan koneksi API.")
 }
}
function setAI(k,el){
 document.body.classList.add("model-switching")
setTimeout(()=>document.body.classList.remove("model-switching"),200)
 current=k
 botName.innerText=AIs[k].name
 botAvatar.src=AIs[k].avatar
 modelInfo.innerText=AIs[k].info
 document.querySelectorAll(".model-card").forEach(x=>x.classList.remove("active"))
 el.classList.add("active")
 closeDrawer()
 chat.innerHTML=""
}
</script>

</body>
</html>