<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Multi Ai By Rafz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="bg-glow"></div>

<div class="toast info" id="toast">
 <i class="fa-solid fa-circle-info"></i>
 <span id="toastText"></span>
</div>

<div class="chat-app">

<div class="chat-header">
 <div class="header-left">
  <img id="botAvatar" src="kiss.jpg">
  <div>
   <b id="botName">Kashiwada-san</b>
   <div class="status">online</div>
  </div>
 </div>
 <div class="header-right" onclick="openDrawer()">☰</div>
</div>

<div class="chat-body" id="chat"></div>

<div class="chat-input">
 <div class="input-box">
  <textarea id="msg" rows="1" placeholder="Ketik pesan..."></textarea>
  <button onclick="send()"><i class="fa-solid fa-paper-plane"></i></button>
 </div>
</div>

</div>

<div class="drawer-overlay" id="overlay" onclick="closeDrawer()"></div>

<div class="drawer" id="drawer">
 <div class="drawer-scroll">

  <h3>Pilih AI</h3>

  <div class="model-card active" onclick="setAI('kashiwada',this)">
   <img src="kiss.jpg"> Kashiwada
  </div>
  <div class="model-card" onclick="setAI('mahiru',this)">
   <img src="mahiru.jpg"> Mahiru
  </div>
  <div class="model-card" onclick="setAI('felo',this)">
   <img src="felo.jpg"> Felo
  </div>
  <div class="model-card" onclick="setAI('koyuki',this)">
   <img src="koyuki.jpg"> Koyuki
   <span class="badge-new">NEW</span>
  </div>

  <div class="model-info" id="modelInfo"></div>

  <h3>Profil User</h3>

  <div class="user-profile">
   <div class="avatar-edit">
    <img id="userAvatarPreview" src="user.jpg">
    <label class="avatar-btn">
     <i class="fa-solid fa-camera"></i>
     <input type="file" id="userAvatarInput" accept="image/*">
    </label>
   </div>

   <div class="name-input">
    <i class="fa-solid fa-user"></i>
    <input type="text" id="userNameInput" placeholder="Nama kamu">
   </div>

   <button class="save-profile" onclick="saveUserProfile()">
    <i class="fa-solid fa-floppy-disk"></i> Simpan Profil
   </button>
  </div>

  <button class="close-btn" onclick="closeDrawer()">Tutup</button>
 </div>
</div>

<script>
const chat=document.getElementById("chat")
const msg=document.getElementById("msg")
const drawer=document.getElementById("drawer")
const overlay=document.getElementById("overlay")
const botName=document.getElementById("botName")
const botAvatar=document.getElementById("botAvatar")
const modelInfo=document.getElementById("modelInfo")

/* TOAST */
const toast=document.getElementById("toast")
const toastText=document.getElementById("toastText")
function showToast(t,type="info"){
 toast.className=`toast ${type} show`
 toastText.innerText=t
 setTimeout(()=>toast.classList.remove("show"),2500)
}

/* PROFILE */
let userName=localStorage.getItem("userName")||"Kamu"
let userAvatar=localStorage.getItem("userAvatar")||"user.jpg"
const nameInput=document.getElementById("userNameInput")
const avatarInput=document.getElementById("userAvatarInput")
const avatarPreview=document.getElementById("userAvatarPreview")
nameInput.value=userName
avatarPreview.src=userAvatar

avatarInput.onchange=()=>{
 const f=avatarInput.files[0]
 if(!f)return
 const r=new FileReader()
 r.onload=()=>{
  userAvatar=r.result
  avatarPreview.src=r.result
  localStorage.setItem("userAvatar",r.result)
 }
 r.readAsDataURL(f)
}

function saveUserProfile(){
 userName=nameInput.value.trim()||"Kamu"
 localStorage.setItem("userName",userName)
 showToast("Profil berhasil disimpan","success")
}

/* UI */
function openDrawer(){drawer.classList.add("active");overlay.classList.add("active")}
function closeDrawer(){drawer.classList.remove("active");overlay.classList.remove("active")}

function formatText(t){
 return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")
 .replace(/\*\*(.*?)\*\*/g,"$1")
 .replace(/\*(.*?)\*/g,"$1")
 .replace(/\n/g,"<br>")
}

/* AI LIST – BALIK SEMUA */
const AIs={
 kashiwada:{
  name:"Kashiwada-san",
  avatar:"kiss.jpg",
  info:"Tenang & sopan",
  api:t=>`https://api.ootaizumi.web.id/character/kashiwada-san?message=${encodeURIComponent(t)}`,
  parse:d=>formatText(d.message)
 },
 mahiru:{
  name:"Shiina Mahiru",
  avatar:"mahiru.jpg",
  info:"Manis & perhatian",
  api:t=>`https://api.ryuu-dev.offc.my.id/ai/mahiru-ai?text=${encodeURIComponent(t)}`,
  parse:d=>formatText(d.output)
 },
 felo:{
  name:"Felo",
  avatar:"felo.jpg",
  info:"Santai & bebas",
  api:t=>`https://api.ryuu-dev.offc.my.id/ai/felo?text=${encodeURIComponent(t)}`,
  parse:d=>formatText(d.result||d.output||d.message)
 },
 koyuki:{
  name:"Koyuki",
  avatar:"koyuki.jpg",
  info:"AI Baru",
  api:t=>`https://api.ryuu-dev.offc.my.id/ai/koyuki?text=${encodeURIComponent(t)}`,
  parse:d=>formatText(d.output||d.result||d.message)
 }
}

let current="kashiwada"
modelInfo.innerText=AIs[current].info

function add(role,html){
 chat.innerHTML+=`
 <div class="row ${role}">
  <img src="${role==='bot'?AIs[current].avatar:userAvatar}">
  <div class="msg-box">
   <div class="msg-name">${role==='bot'?AIs[current].name:userName}</div>
   <div class="bubble ${role}">${html}</div>
  </div>
 </div>`
 chat.scrollTop=chat.scrollHeight
}

async function send(){
 const t=msg.value.trim()
 if(!t)return
 add("user",formatText(t))
 msg.value=""

 chat.innerHTML+=`
 <div class="row bot">
  <img src="${AIs[current].avatar}">
  <div class="typing"><span></span><span></span><span></span></div>
 </div>`

 try{
  const r=await fetch(AIs[current].api(t))
  const d=await r.json()
  chat.lastElementChild.remove()
  add("bot",AIs[current].parse(d))
 }catch{
  chat.lastElementChild.remove()
  add("bot","❌ Error koneksi")
 }
}

function setAI(k,el){
 current=k
 botName.innerText=AIs[k].name
 botAvatar.src=AIs[k].avatar
 modelInfo.innerText=AIs[k].info
 document.querySelectorAll(".model-card").forEach(x=>x.classList.remove("active"))
 el.classList.add("active")
 chat.innerHTML=""
 closeDrawer()
}

window.onload=()=>{
 showToast("Pesan bersifat sementara","info")
}
</script>

</body>
</html>